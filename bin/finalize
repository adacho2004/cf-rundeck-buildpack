#!/usr/bin/env bash

# Absolute path
BIN_DIR=$(cd $(dirname $0) && pwd)

BUILD_DIR=$1
CACHE_DIR=$2
DEPS_DIR=$3
INDEX=$4

echo "-----> Creating start script"
cp ${BIN_DIR}/../startRundeck.sh ${BUILD_DIR}/startRundeck.sh
chmod +x ${BUILD_DIR}/startRundeck.sh

echo "-----> Installing Rundeck"
export RDECK_BASE=${BUILD_DIR}
java -jar ${BUILD_DIR}/rundeck.jar -b ${BUILD_DIR} --install-only

echo "-----> Symlinking properties"
cd ${BUILD_DIR}/server/config
rm -f rundeck-config.properties
ln -s ../../rundeck-config.properties rundeck-config.properties

